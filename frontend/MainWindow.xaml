<Window x:Class="WeatherApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WeatherApp"
        xmlns:vm="clr-namespace:WeatherApp.ViewModels"
        mc:Ignorable="d"
        Title="天气应用" 
        Height="800" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F7FA">
    
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>
    
    <Window.Resources>
        <!-- 颜色定义 -->
        <Color x:Key="PrimaryColor">#2196F3</Color>
        <Color x:Key="SecondaryColor">#03A9F4</Color>
        <Color x:Key="AccentColor">#00BCD4</Color>
        <Color x:Key="LightBackground">#F5F7FA</Color>
        <Color x:Key="CardBackground">#FFFFFF</Color>
        <Color x:Key="TextPrimary">#212121</Color>
        <Color x:Key="TextSecondary">#757575</Color>
        
        <!-- 画笔 -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="{StaticResource PrimaryColor}"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="{StaticResource SecondaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="LightBackgroundBrush" Color="{StaticResource LightBackground}"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="{StaticResource CardBackground}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimary}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondary}"/>
        
        <!-- 样式 -->
        <Style TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="20" 
                                      Opacity="0.1" 
                                      ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>
        
        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 图标样式 -->
        <Style x:Key="WeatherIconStyle" TargetType="Path">
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="Fill" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Stroke" Value="{StaticResource SecondaryBrush}"/>
            <Setter Property="StrokeThickness" Value="1"/>
        </Style>
        
        <!-- 数据模板 -->
        <DataTemplate x:Key="HourlyForecastTemplate">
            <Border Width="80" 
                    Height="100" 
                    Margin="5" 
                    Background="Transparent">
                <StackPanel VerticalAlignment="Center" 
                            HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Time, StringFormat=HH:mm}" 
                               HorizontalAlignment="Center"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    
                    <Viewbox Width="32" Height="32" Margin="0,5">
                        <ContentControl Content="{Binding IconName}">
                            <ContentControl.Resources>
                                <!-- 这里可以定义图标模板 -->
                            </ContentControl.Resources>
                        </ContentControl>
                    </Viewbox>
                    
                    <TextBlock Text="{Binding Temperature, StringFormat={}{0}°}" 
                               HorizontalAlignment="Center"
                               FontSize="14"
                               FontWeight="SemiBold"/>
                    
                    <TextBlock Text="{Binding PrecipitationProbability, StringFormat={}{0}%}" 
                               HorizontalAlignment="Center"
                               FontSize="10"
                               Foreground="{StaticResource SecondaryBrush}"/>
                </StackPanel>
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="DailyForecastTemplate">
            <Border Width="120" 
                    Height="140" 
                    Margin="5" 
                    Background="Transparent">
                <StackPanel VerticalAlignment="Center" 
                            HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Date, StringFormat=ddd}" 
                               HorizontalAlignment="Center"
                               FontSize="14"
                               FontWeight="SemiBold"/>
                    
                    <TextBlock Text="{Binding Date, StringFormat=MM/dd}" 
                               HorizontalAlignment="Center"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,0,0,5"/>
                    
                    <Viewbox Width="40" Height="40" Margin="0,5">
                        <ContentControl Content="{Binding IconName}">
                            <ContentControl.Resources>
                                <!-- 这里可以定义图标模板 -->
                            </ContentControl.Resources>
                        </ContentControl>
                    </Viewbox>
                    
                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Center" 
                                Margin="0,5">
                        <TextBlock Text="{Binding TempMax, StringFormat={}{0}°}" 
                                   FontSize="14"
                                   FontWeight="SemiBold"/>
                        <TextBlock Text="/" 
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="2,0"/>
                        <TextBlock Text="{Binding TempMin, StringFormat={}{0}°}" 
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                    
                    <TextBlock Text="{Binding Condition}" 
                               HorizontalAlignment="Center"
                               FontSize="11"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               MaxWidth="100"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 标题栏 -->
        <Border Grid.Row="0" 
                Background="{StaticResource PrimaryBrush}" 
                Padding="20,15"
                CornerRadius="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 应用标题 -->
                <StackPanel Grid.Column="0" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center">
                    <Path Data="M12,2L14.5,8.5L21,9.5L16,14L17.5,21L12,17.5L6.5,21L8,14L3,9.5L9.5,8.5L12,2Z" 
                          Fill="White" 
                          Width="24" 
                          Height="24"
                          Margin="0,0,10,0"/>
                    <TextBlock Text="天气应用" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Foreground="White"/>
                </StackPanel>
                
                <!-- 搜索框 -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <TextBox x:Name="SearchTextBox" 
                             Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                             Width="300" 
                             Height="40" 
                             FontSize="16"
                             Padding="15,0"
                             VerticalContentAlignment="Center"
                             Background="White"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             BorderThickness="0"
                             CornerRadius="20">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                    
                    <Button Content="搜索" 
                            Command="{Binding SearchCommand}"
                            Width="80"
                            Height="40"
                            Margin="10,0,0,0"
                            CornerRadius="20"/>
                    
                    <Button Content="刷新" 
                            Command="{Binding RefreshCommand}"
                            Width="80"
                            Height="40"
                            Margin="10,0,0,0"
                            CornerRadius="20"
                            Background="{StaticResource SecondaryBrush}"/>
                </StackPanel>
                
                <!-- 当前时间 -->
                <StackPanel Grid.Column="2" 
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <TextBlock Text="{Binding CurrentWeather.Timestamp, StringFormat='HH:mm'}" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White"/>
                    <TextBlock Text="{Binding CurrentWeather.Timestamp, StringFormat='yyyy/MM/dd dddd'}" 
                               FontSize="12" 
                               Foreground="White"
                               Opacity="0.9"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- 主内容区域 -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- 当前位置和状态 -->
            <StackPanel Grid.Row="0" 
                        Orientation="Horizontal" 
                        Margin="0,0,0,20">
                <TextBlock Text="{Binding CurrentWeather.City}" 
                           FontSize="28" 
                           FontWeight="Bold"
                           VerticalAlignment="Center"/>
                
                <TextBlock Text=", " 
                           FontSize="28" 
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Margin="0,0,5,0"/>
                
                <TextBlock Text="{Binding CurrentWeather.Country}" 
                           FontSize="28" 
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
                
                <TextBlock Text="{Binding StatusMessage}" 
                           FontSize="14"
                           VerticalAlignment="Center"
                           Margin="20,0,0,0"
                           Foreground="{StaticResource SecondaryBrush}"
                           FontStyle="Italic"/>
                
                <!-- 加载指示器 -->
                <Border Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Width="20" 
                        Height="20" 
                        Margin="20,0,0,0"
                        VerticalAlignment="Center">
                    <Border.Resources>
                        <Storyboard x:Key="RotateAnimation" RepeatBehavior="Forever">
                            <DoubleAnimation From="0" To="360" Duration="0:0:1"
                                             Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"/>
                        </Storyboard>
                    </Border.Resources>
                    <Border.RenderTransform>
                        <RotateTransform CenterX="10" CenterY="10"/>
                    </Border.RenderTransform>
                    <Ellipse Stroke="{StaticResource PrimaryBrush}" 
                             StrokeThickness="2" 
                             StrokeDashArray="2,2"/>
                </Border>
            </StackPanel>
            
            <!-- 当前天气卡片 -->
            <Border Grid.Row="1" 
                    Padding="40" 
                    Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 天气信息 -->
                    <StackPanel Grid.Column="0" 
                                VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" 
                                    Margin="0,0,0,20">
                            <TextBlock Text="{Binding CurrentWeather.Temperature, StringFormat={}{0}°}" 
                                       FontSize="100" 
                                       FontWeight="Light"
                                       Foreground="{StaticResource PrimaryBrush}"/>
                            
                            <StackPanel Margin="30,0,0,0" 
                                        VerticalAlignment="Center">
                                <TextBlock Text="{Binding CurrentWeather.Condition}" 
                                           FontSize="32" 
                                           FontWeight="SemiBold"/>
                                
                                <TextBlock Text="体感温度" 
                                           FontSize="16"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,5,0,0"/>
                                
                                <TextBlock Text="{Binding CurrentWeather.FeelsLike, StringFormat={}{0}°}" 
                                           FontSize="24" 
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- 详细天气信息 -->
                        <WrapPanel Margin="0,20,0,0">
                            <StackPanel Orientation="Horizontal" 
                                        Margin="0,0,30,10">
                                <Path Data="M12,2L14.5,8.5L21,9.5L16,14L17.5,21L12,17.5L6.5,21L8,14L3,9.5L9.5,8.5L12,2Z" 
                                      Fill="{StaticResource SecondaryBrush}" 
                                      Width="20" 
                                      Height="20"
                                      Margin="0,0,10,0"/>
                                <StackPanel>
                                    <TextBlock Text="湿度" 
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="{Binding CurrentWeather.Humidity, StringFormat={}{0}%}" 
                                               FontSize="18" 
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" 
                                        Margin="0,0,30,10">
                                <Path Data="M12,2L15.09,8.26L22,9.27L17,14.14L18.18,21.02L12,17.77L5.82,21.02L7,14.14L2,9.27L8.91,8.26L12,2Z" 
                                      Fill="{StaticResource SecondaryBrush}" 
                                      Width="20" 
                                      Height="20"
                                      Margin="0,0,10,0"/>
                                <StackPanel>
                                    <TextBlock Text="风速" 
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="{Binding CurrentWeather.WindSpeed, StringFormat={}{0} km/h}" 
                                               FontSize="18" 
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- 可以添加更多天气指标 -->
                        </WrapPanel>
                    </StackPanel>
                    
                    <!-- 天气图标 -->
                    <Viewbox Grid.Column="1" 
                             Width="200" 
                             Height="200" 
                             VerticalAlignment="Center">
                        <ContentControl Content="{Binding CurrentWeather.IconName}">
                            <ContentControl.Resources>
                                <!-- 天气图标模板 -->
                                <DataTemplate DataType="{x:Type system:String}">
                                    <Grid>
                                        <!-- 根据图标名称显示不同的矢量图形 -->
                                        <Path Style="{StaticResource WeatherIconStyle}"
                                              Data="{Binding Converter={StaticResource IconNameToPathDataConverter}}"/>
                                    </Grid>
                                </DataTemplate>
                            </ContentControl.Resources>
                        </ContentControl>
                    </Viewbox>
                </Grid>
            </Border>
            
            <!-- 预报区域 -->
            <Grid Grid.Row="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 选项卡 -->
                <TabControl Grid.Row="0" 
                            Background="Transparent" 
                            BorderThickness="0">
                    <TabItem Header="逐小时预报">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding HourlyForecasts}"
                                          ItemTemplate="{StaticResource HourlyForecastTemplate}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="7日预报">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                      VerticalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding DailyForecasts}"
                                          ItemTemplate="{StaticResource DailyForecastTemplate}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
        
        <!-- 状态栏 -->
        <Border Grid.Row="2" 
                Background="{StaticResource SecondaryBrush}" 
                Padding="15"
                CornerRadius="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="数据来源: Open-Meteo API" 
                           Foreground="White" 
                           FontSize="12"
                           VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Content="设置" 
                            Background="Transparent" 
                            BorderThickness="0"
                            Foreground="White"
                            Padding="10,5"/>
                    
                    <Button Content="关于" 
                            Background="Transparent" 
                            BorderThickness="0"
                            Foreground="White"
                            Padding="10,5"
                            Margin="10,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>